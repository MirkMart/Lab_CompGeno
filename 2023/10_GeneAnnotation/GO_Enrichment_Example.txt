#go2genes = go term annotation for all genese
#list_expanded_genes.txt = list of genes of interest

library(tidyr)
library(plyr)
library(topGO)

geneID2GO <- readMappings(file = "go2genes.txt")
geneUniverse <- names(geneID2GO)

genesOfInterest <- read.table("list_expanded_genes.txt",header=FALSE)
genesOfInterest <- as.character(genesOfInterest$V1)
geneList <- factor(as.integer(geneUniverse %in% genesOfInterest))
names(geneList) <- geneUniverse
myGOdata <- new("topGOdata", description="My project", ontology="BP", allGenes=geneList,  annot = annFUN.gene2GO, gene2GO = geneID2GO, nodeSize=5)

Expanded_BP_classic_fisher <- runTest(myGOdata, algorithm="weight01", statistic="fisher")

Expanded_BP_allRes <- GenTable(myGOdata, 
                                Classic_Fisher = Expanded_BP_classic_fisher,
                                orderBy = "Classic_Fisher", topNodes=1000)

Expanded_BP_allRes$Classic_Fisher <- as.numeric(Expanded_BP_allRes$Classic_Fisher)
Expanded_BP_allRes <- subset(Expanded_BP_allRes, Classic_Fisher < 0.05)
